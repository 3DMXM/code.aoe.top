(function(a){if(typeof exports==="object"&&typeof module==="object"){a(require("../../lib/codemirror"))}else{if(typeof define==="function"&&define.amd){define(["../../lib/codemirror"],a)}else{a(CodeMirror)}}})(function(b){var d;b.defineOption("searchbox",false,function(h){h.addKeyMap({"Ctrl-F":function(){if(!d){d=new g(h)}d.show()},Esc:function(){if(d&&d.isVisible()){d.hide();if(typeof event!=="undefined"){event.stopPropagation()}}return false},"Cmd-F":function(){if(!d){d=new g(h)}d.show()}})});function g(h){var j=this;o();function i(p){j.searchBox=p.querySelector(".ace_search_form");j.replaceBox=p.querySelector(".ace_replace_form");j.searchOptions=p.querySelector(".ace_search_options");j.regExpOption=p.querySelector("[action=toggleRegexpMode]");j.caseSensitiveOption=p.querySelector("[action=toggleCaseSensitive]");j.wholeWordOption=p.querySelector("[action=toggleWholeWords]");j.searchInput=j.searchBox.querySelector(".ace_search_field");j.replaceInput=j.replaceBox.querySelector(".ace_search_field")}function o(){var p=j.element=l();k();i(p);m();p.addEventListener("mousedown",function(q){setTimeout(function(){j.activeInput.focus()},0);q.stopPropagation()});p.addEventListener("click",function(s){var q=s.target||s.srcElement;var r=q.getAttribute("action");if(r&&j[r]){j[r]()}else{if(j.commands[r]){j.commands[r]()}}s.stopPropagation()});j.searchInput.addEventListener("input",function(){j.$onChange.schedule(20)});j.searchInput.addEventListener("focus",function(){j.activeInput=j.searchInput});j.replaceInput.addEventListener("focus",function(){j.activeInput=j.replaceInput});j.$onChange=f(function(){j.find(false,false)})}function m(){var q=j,p={"Ctrl-F|Cmd-F|Ctrl-H|Command-Alt-F":function(){var r=q.isReplace=!q.isReplace;q.replaceBox.style.display=r?"":"none";q[r?"replaceInput":"searchInput"].focus()},"Ctrl-G|Cmd-G":function(){q.findNext()},"Ctrl-Shift-G|Cmd-Shift-G":function(){q.findPrev()},Esc:function(){setTimeout(function(){q.hide()})},Enter:function(){if(q.activeInput===q.replaceInput){q.replace()}q.findNext()},"Shift-Enter":function(){if(q.activeInput===q.replaceInput){q.replace()}q.findPrev()},"Alt-Enter":function(){if(q.activeInput===q.replaceInput){q.replaceAll()}q.findAll()},Tab:function(){if(j.activeInput===j.replaceInput){j.searchInput.focus()}else{j.replaceInput.focus()}}};j.element.addEventListener("keydown",function(r){Object.keys(p).some(function(s){var t=e(s,r);if(t){r.stopPropagation();r.preventDefault();p[s](r)}return t})})}this.commands={toggleRegexpMode:function(){j.regExpOption.checked=!j.regExpOption.checked;j.$syncOptions()},toggleCaseSensitive:function(){j.caseSensitiveOption.checked=!j.caseSensitiveOption.checked;j.$syncOptions()},toggleWholeWords:function(){j.wholeWordOption.checked=!j.wholeWordOption.checked;j.$syncOptions()}};this.$syncOptions=function(){c(this.regExpOption,"checked",this.regExpOption.checked);c(this.wholeWordOption,"checked",this.wholeWordOption.checked);c(this.caseSensitiveOption,"checked",this.caseSensitiveOption.checked);this.find(false,false)};this.find=function(s,p){var r=this.searchInput.value,q={skipCurrent:s,backwards:p,regExp:this.regExpOption.checked,caseSensitive:this.caseSensitiveOption.checked,wholeWord:this.wholeWordOption.checked};n(r,q,function(t){var u=t.matches(false,t.from());h.setSelection(u.from,u.to)})};function n(A,E,D){var s,B,p,w,r,v,C,u,q=E,t=true,y=q.caseSensitive,x=q.regExp,z=q.wholeWord;if(x||z){if(E.wholeWord){A="\\b"+A+"\\b"}A=RegExp(A)}if(q.backwards){u=q.skipCurrent?"from":"to"}else{u=q.skipCurrent?"to":"from"}C=h.getCursor(u);p=h.getSearchCursor(A,C,!y);w=p.findNext.bind(p),r=p.findPrevious.bind(p),v=p.matches.bind(p);if(q.backwards&&!r()){t=w();if(t){h.setCursor(h.doc.size-1,0);n(true,true,D);s=true}}else{if(!q.backwards&&!w()){t=r();if(t){h.setCursor(0,0);n(true,false,D);s=true}}}B=!t&&j.searchInput.value;c(j.searchBox,"ace_nomatch",B);if(!s&&t){D(p)}}this.findNext=function(){this.find(true,false)};this.findPrev=function(){this.find(true,true)};this.findAll=function(){var r=this.searchInput.value,q,p=!q&&this.searchInput.value;c(this.searchBox,"ace_nomatch",p);if(h.showMatchesOnScrollbar){h.showMatchesOnScrollbar(r)}this.hide()};this.replace=function(){if(!h.getOption("readOnly")){h.replaceSelection(this.replaceInput.value,"start")}};this.replaceAndFindNext=function(){if(!h.getOption("readOnly")){this.editor.replace(this.replaceInput.value);this.findNext()}};this.replaceAll=function(){var q,r,t=this.searchInput.value,s=this.replaceInput.value,p=RegExp(t,"g");if(!h.getOption("readOnly")){r=h.getCursor();q=h.getValue();q=q.replace(p,s);h.setValue(q);h.setCursor(r)}};this.hide=function(){this.element.style.display="none";h.focus()};this.isVisible=function(){var p=this.element.style.display==="";return p};this.show=function(p,q){this.element.style.display="";this.replaceBox.style.display=q?"":"none";this.isReplace=q;if(p){this.searchInput.value=p}this.searchInput.focus();this.searchInput.select()};this.isFocused=function(){var p=document.activeElement;return p===this.searchInput||p===this.replaceInput};function k(){var q=document.createElement("style"),p=[".ace_search {","background-color: #ddd;","border: 1px solid #cbcbcb;","border-top: 0 none;","max-width: 325px;","overflow: hidden;","margin: 0;","padding: 4px;","padding-right: 6px;","padding-bottom: 0;","position: absolute;","top: 0px;","z-index: 99;","white-space: normal;","}",".ace_search.left {","border-left: 0 none;","border-radius: 0px 0px 5px 0px;","left: 0;","}",".ace_search.right {","border-radius: 0px 0px 0px 5px;","border-right: 0 none;","right: 0;","}",".ace_search_form, .ace_replace_form {","border-radius: 3px;","border: 1px solid #cbcbcb;","float: left;","margin-bottom: 4px;","overflow: hidden;","}",".ace_search_form.ace_nomatch {","outline: 1px solid red;","}",".ace_search_field {","background-color: white;","border-right: 1px solid #cbcbcb;","border: 0 none;","-webkit-box-sizing: border-box;","-moz-box-sizing: border-box;","box-sizing: border-box;","float: left;","height: 22px;","outline: 0;","padding: 0 7px;","width: 214px;","margin: 0;","}",".ace_searchbtn,",".ace_replacebtn {","background: #fff;","border: 0 none;","border-left: 1px solid #dcdcdc;","cursor: pointer;","float: left;","height: 22px;","margin: 0;","padding: 0;","position: relative;","}",".ace_searchbtn:last-child,",".ace_replacebtn:last-child {","border-top-right-radius: 3px;","border-bottom-right-radius: 3px;","}",".ace_searchbtn:disabled {","background: none;","cursor: default;","}",".ace_searchbtn {","background-position: 50% 50%;","background-repeat: no-repeat;","width: 27px;","}",".ace_searchbtn.prev {","background-image: url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAgAAAAFCAYAAAB4ka1VAAAAGXRFWHRTb2Z0d2FyZQBBZG9iZSBJbWFnZVJlYWR5ccllPAAAADFJREFUeNpiSU1NZUAC/6E0I0yACYskCpsJiySKIiY0SUZk40FyTEgCjGgKwTRAgAEAQJUIPCE+qfkAAAAASUVORK5CYII=);    ","}",".ace_searchbtn.next {","background-image: url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAgAAAAFCAYAAAB4ka1VAAAAGXRFWHRTb2Z0d2FyZQBBZG9iZSBJbWFnZVJlYWR5ccllPAAAADRJREFUeNpiTE1NZQCC/0DMyIAKwGJMUAYDEo3M/s+EpvM/mkKwCQxYjIeLMaELoLMBAgwAU7UJObTKsvAAAAAASUVORK5CYII=);    ","}",".ace_searchbtn_close {","background: url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAA4AAAAcCAYAAABRVo5BAAAAZ0lEQVR42u2SUQrAMAhDvazn8OjZBilCkYVVxiis8H4CT0VrAJb4WHT3C5xU2a2IQZXJjiQIRMdkEoJ5Q2yMqpfDIo+XY4k6h+YXOyKqTIj5REaxloNAd0xiKmAtsTHqW8sR2W5f7gCu5nWFUpVjZwAAAABJRU5ErkJggg==) no-repeat 50% 0;","border-radius: 50%;","border: 0 none;","color: #656565;","cursor: pointer;","float: right;","font: 16px/16px Arial;","height: 14px;","margin: 5px 1px 9px 5px;","padding: 0;","text-align: center;","width: 14px;","}",".ace_searchbtn_close:hover {","background-color: #656565;","background-position: 50% 100%;","color: white;","}",".ace_replacebtn.prev {","width: 54px","}",".ace_replacebtn.next {","width: 27px","}",".ace_button {","margin-left: 2px;","cursor: pointer;","-webkit-user-select: none;","-moz-user-select: none;","-o-user-select: none;","-ms-user-select: none;","user-select: none;","overflow: hidden;","opacity: 0.7;","border: 1px solid rgba(100,100,100,0.23);","padding: 1px;","-moz-box-sizing: border-box;","box-sizing:    border-box;","color: black;","}",".ace_button:hover {","background-color: #eee;","opacity:1;","}",".ace_button:active {","background-color: #ddd;","}",".ace_button.checked {","border-color: #3399ff;","opacity:1;","}",".ace_search_options{","margin-bottom: 3px;","text-align: right;","-webkit-user-select: none;","-moz-user-select: none;","-o-user-select: none;","-ms-user-select: none;","user-select: none;","}"].join("");q.setAttribute("data-name","js-searchbox");q.textContent=p;document.head.appendChild(q)}function l(){var r,q=document.querySelector(".CodeMirror"),s=document.createElement("div"),p=['<div class="ace_search right">','<button type="button" action="hide" class="ace_searchbtn_close"></button>','<div class="ace_search_form">','<input class="ace_search_field" placeholder="Search for" spellcheck="false"></input>','<button type="button" action="findNext" class="ace_searchbtn next"></button>','<button type="button" action="findPrev" class="ace_searchbtn prev"></button>','<button type="button" action="findAll" class="ace_searchbtn" title="Alt-Enter">All</button>',"</div>",'<div class="ace_replace_form">','<input class="ace_search_field" placeholder="Replace with" spellcheck="false"></input>','<button type="button" action="replaceAndFindNext" class="ace_replacebtn">Replace</button>','<button type="button" action="replaceAll" class="ace_replacebtn">All</button>',"</div>",'<div class="ace_search_options">','<span action="toggleRegexpMode" class="ace_button" title="RegExp Search">.*</span>','<span action="toggleCaseSensitive" class="ace_button" title="CaseSensitive Search">Aa</span>','<span action="toggleWholeWords" class="ace_button" title="Whole Word Search">\\b</span>',"</div>","</div>"].join("");s.innerHTML=p;r=s.firstChild;q.parentElement.appendChild(r);return r}}function c(i,h,k){var j=i.classList;j[k?"add":"remove"](h)}function f(j,i){var l,k=function(){l=null;j()},h=function(m){if(!l){l=setTimeout(k,m||i)}};h.delay=function(m){l&&clearTimeout(l);l=setTimeout(k,m||i)};h.schedule=h;h.call=function(){this.cancel();j()};h.cancel=function(){l&&clearTimeout(l);l=null};h.isPending=function(){return l};return h}function e(k,j){var i,h={BACKSPACE:8,TAB:9,ENTER:13,ESC:27,SPACE:32,PAGE_UP:33,PAGE_DOWN:34,END:35,HOME:36,UP:38,DOWN:40,INSERT:45,DELETE:46,INSERT_MAC:96,ASTERISK:106,PLUS:107,MINUS:109,F1:112,F2:113,F3:114,F4:115,F5:116,F6:117,F7:118,F8:119,F9:120,F10:121,SLASH:191,TRA:192,BACKSLASH:220};a(k,j);i=k.split("|").some(function(m){var l;l=m.split("-").some(function(o){var n;switch(o){case"Ctrl":n=j.ctrlKey;break;case"Shift":n=j.shiftKey;break;case"Alt":n=j.altKey;break;case"Cmd":n=j.metaKey;break;default:if(o.length===1){n=j.keyCode===o.charCodeAt(0)}else{Object.keys(h).some(function(q){var p=o.toUpperCase();if(p===q){n=j.keyCode===h[q]}})}break}return !n});return !l});return i}function a(i,h){if(typeof i!=="string"){throw (Error("str should be string!"))}if(typeof h!=="object"){throw (Error("event should be object!"))}}});